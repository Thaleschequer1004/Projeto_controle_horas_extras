<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - Gestor</title>
    <link rel="shortcut icon" href="../../imagens/favoicon_fortes.jpeg" type="image/jpeg">
    <link rel="stylesheet" href="style_gestor.css">
    <!-- Biblioteca mágica para baixar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>

    <div class="layout-container">
        
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../imagens/logo_fortes_engenharia.jpeg" alt="Fortes Engenharia" class="logo-sidebar">
            </div>
            <nav class="sidebar-nav">
                <a href="gestor_dashboard.html" class="nav-item">
                    <i class="fas fa-chart-line"></i> Dashboard
                    <!-- AQUI ESTÁ O SEGREDO: BADGE NO MENU -->
                    <span class="notification-badge" id="badgeSidebarRelatorio">2</span>
                </a>
                <a href="#" class="nav-item active">
                    <i class="fas fa-file-alt"></i> Relatórios
                </a>
                <a href="config_gestor.html" class="nav-item">
                    <i class="fas fa-cog"></i> Regras e Config.
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="avatar">JP</div>
                    <div class="user-text">
                        <strong>João Pedro</strong>
                        <span>Gestor</span>
                    </div>
                </div>
                <a href="config_gestor.html" class="btn-config"><i class="fas fa-cog"></i> Configurações</a>
                <a href="../../login/login.html" class="btn-sair"><i class="fas fa-sign-out-alt"></i> Sair</a>
            </div>
        </aside>

        <main class="content">
            
            <header class="section-header print-header">
                <div>
                    <h2>Relatórios e Exportação</h2>
                    <p>Configure e exporte relatórios históricos de horas extras</p>
                </div>
            </header>

            <!-- 1. CONFIGURAR RELATÓRIO -->
            <section class="card-painel no-print">
                <h3>Configurar Relatório</h3>
                
                <div class="filtros-grid-2col">
                    <div class="form-group">
                        <label>Período - Data Início</label>
                        <input type="date" id="dataInicio" value="2025-10-31">
                    </div>
                    <div class="form-group">
                        <label>Período - Data Fim</label>
                        <input type="date" id="dataFim" value="2025-11-16">
                    </div>
                    <div class="form-group">
                        <label>Agrupar Por</label>
                        <select id="agruparPor" onchange="atualizarVisualTabela()">
                            <option value="obra">Por Obra</option>
                            <option value="colaborador">Por Colaborador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Filtrar Obra</label>
                        <select id="filtrarObra">
                            <option value="todas">Todas as obras</option>
                            <option value="vm">Obra Vitória Marina</option>
                            <option value="pn">Obra Ponte Norte</option>
                        </select>
                    </div>
                </div>

                <div class="painel-footer-buttons">
                    <!-- Botão que vira verde -->
                    <button id="btnSalvarTemplate" class="btn-secundario" onclick="salvarTemplate()">
                        <i class="far fa-save"></i> Salvar como Template
                    </button>
                </div>
            </section>

            <!-- 2. PREVIEW (ÁREA QUE VAI PRO PDF) -->
            <section class="card-painel" id="areaParaPDF">
                <div class="preview-header">
                    <div class="title-area">
                        <h3>Preview do Relatório</h3>
                        <!-- Badge Verde que aparece ao exportar -->
                        <span id="badgeSucessoExport" class="badge-success-pill" style="display: none;">
                            Exportado com sucesso
                        </span>
                    </div>
                    
                    <!-- Botões de Ação (Eles somem no PDF graças à classe html2pdf-ignore) -->
                    <div class="export-actions" data-html2canvas-ignore="true">
                        <button class="btn-export" onclick="alert('CSV gerado (Simulação)')">
                            <i class="fas fa-file-csv"></i> Exportar CSV
                        </button>
                        <button class="btn-export vermelho" onclick="gerarPDFReal()">
                            <i class="fas fa-file-pdf"></i> Exportar PDF
                        </button>
                    </div>
                </div>

                <!-- Resumo Stats -->
                <div class="resumo-stats-row">
                    <div class="stat-item">
                        <span class="label">Total de Solicitações</span>
                        <strong class="value">1</strong>
                    </div>
                    <div class="stat-item">
                        <span class="label">Total de Horas</span>
                        <strong class="value">2h</strong>
                    </div>
                    <div class="stat-item">
                        <span class="label">Período</span>
                        <strong class="value-small">31/10/2025 - 16/11/2025</strong>
                    </div>
                </div>

                <!-- Tabela -->
                <div class="table-responsive">
                    <table class="tabela-preview" id="tabelaRelatorio">
                        <thead>
                            <tr>
                                <th>Obra</th>
                                <th>Código</th>
                                <th class="text-center">Solicitações</th>
                                <th class="text-right">Total Horas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados fixos iniciais -->
                            <tr>
                                <td>Obra Vitória Marina</td>
                                <td>VM-2025</td>
                                <td class="text-center">1</td>
                                <td class="text-right">2h</td>
                            </tr>
                            <tr>
                                <td>Obra Ponte Norte</td>
                                <td>PN-2024</td>
                                <td class="text-center">0</td>
                                <td class="text-right">0h</td>
                            </tr>
                            <tr>
                                <td>Obra Centro Logístico</td>
                                <td>CL-2025</td>
                                <td class="text-center">0</td>
                                <td class="text-right">0h</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="row-total">
                                <td colspan="2"><strong>Total</strong></td>
                                <td class="text-center"><strong>1</strong></td>
                                <td class="text-right"><strong>2h</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>

            <!-- 3. DICAS -->
            <section class="dicas-container">
                <h4>Dicas de Uso</h4>
                <ul>
                    <li>Use "Salvar como Template" para reutilizar configurações de relatórios frequentes</li>
                    <li>Exporte em CSV para análise em planilhas (Excel, Google Sheets)</li>
                    <li>Exporte em PDF para compartilhamento formal e arquivamento</li>
                    <li>Agrupe por Obra para análise de custos por projeto</li>
                    <li>Agrupe por Colaborador para controle individual de horas</li>
                </ul>
            </section>

        </main>
    </div>

    <script src="script_gestor.js"></script>
</body>
</html>